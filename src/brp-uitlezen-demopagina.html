<!doctype html>
<html lang="nl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta value="https://privacybydesign.foundation/tomcat/irma_api_server/server/" name="irma-web-server">
	<meta value="https://demo.irmacard.org/tomcat/irma_api_server/api/v2/" name="irma-api-server">
	<!-- JQuery -->
	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="https://demo.irmacard.org/tomcat/irma_api_server/client/irma.js" type="text/javascript" defer async></script>
	<SCRIPT src="js/jwt-decode.js" type="text/javascript"></SCRIPT>	

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Material Design Bootstrap combined with custom styles -->
    <link rel="stylesheet" href="css/main.css">

    <title>IRMA demonstratie BRP gegevens</title>
	<style>
		body { padding: 100px 0 0; }
		main .row { padding: 10px 0; }
		footer.page-footer { margin-top: 50px; }
		#irma-cancel-button{display:none;}
	</style>
	<script type="text/javascript">
		var sprequest = {
			"request": {
				"content": [
					{
						"label": "bsn",
						"attributes": ["pbdf.nijmegen.bsn.bsn"]
					},	
                    {
						"label": "fullname",
						"attributes": ["pbdf.nijmegen.personalData.fullname"]
					},						
					{
						"label": "straat",
						"attributes": ["pbdf.nijmegen.address.street"]
					},						
					{
						"label": "huisnummer",
						"attributes": ["pbdf.nijmegen.address.houseNumber"]
					},						
					{
						"label": "postcode",
						"attributes": ["pbdf.nijmegen.address.zipcode"]
					},						
					{
						"label": "woonplaats",
						"attributes": ["pbdf.nijmegen.address.city"]
					},
					{
						"label": "boven18",
						"attributes": ["pbdf.nijmegen.ageLimits.over18"]
					}					
				]
			}
		};
		var success = function(jwt) {
			console.log("Success:", jwt);
			token = jwt_decode(jwt);
			$("#bsn").val(token.attributes["pbdf.nijmegen.bsn.bsn"]);	
            $("#fullname").val(token.attributes["pbdf.nijmegen.personalData.fullname"]);	
			$("#adres").val(token.attributes["pbdf.nijmegen.address.street"] + ' ' + token.attributes["pbdf.nijmegen.address.houseNumber"]);			
			$("#postcode").val(token.attributes["pbdf.nijmegen.address.zipcode"]);
			$("#gemeente").val(token.attributes["pbdf.nijmegen.address.municipality"]);
			$("#woonplaats").val(token.attributes["pbdf.nijmegen.address.zipcode"] + '  ' + token.attributes["pbdf.nijmegen.address.city"]);

			var over18 = token.attributes["pbdf.nijmegen.ageLimits.over18"];
			var mapObj = {
				Yes:"Ja",
				No:"Nee",
			};
			over18 = over18.replace(/Yes|No/gi, function(map){
				return mapObj[map];
			});
			$("#over18").val(over18);
		}
		var warning = function() { feedback("Waarschuwing: attributen niet opgehaald", arguments); }
		var error = function() { feedback("Fout: attributen niet opgehaald", arguments); }
		var clicked = function() {
			$("#intro").hide();
			feedback('');
			var jwt = IRMA.createUnsignedVerificationJWT(sprequest);
			IRMA.verify(jwt, success, warning, error);
		};
		
		function feedback(txt){
			$("#feedback").html(txt);
		}
	</script>
</head>
<body>

<nav class="navbar fixed-top navbar-toggleable-md scrolling-navbar navbar-primary">
    <div class="container">
        <a class="navbar-brand" href="https://nijmegen.nl">
            <div class="navbar-brand-container">
                <img src="img/beeldmerklabelwit.svg" class="logo-labeled" alt="">
                <img src="img/beeldmerkwit.svg" class="logo" alt="">
            </div>
        </a>
        <div class="collapse navbar-collapse" id="navbar-collapse">
            <form action="https://www.nijmegen.nl" class="form-inline">
                <label for="frm-navbar-search" class="sr-only">Zoeken</label>
                <input class="form-control" id="oi-query" type="text" placeholder="Zoeken" autocomplete="off">
                <button type="button" class="btn-search"><i class="mdi mdi-magnify" aria-hidden="true"></i></button>
            </form>
        </div>
    </div>
</nav>

<main>
    <div class="container">
		<h1>Demonstratie BRP gegevens invullen met IRMA</h1>
		<div id="intro">
		<p>
		Op deze pagina kunt u het automatisch invullen van BRP testgegevens via de <a href="https://privacybydesign.foundation/irma/">IRMA app</a> testen.
		Voor deze demonstratie moet u vooraf de IRMA app <a href="https://privacybydesign.foundation/download/">installeren</a> 
		en <a href="https://github.com/GemeenteNijmegen/irma-brp-opladen">BRP testgegevens laden</a> in de IRMA app.
		</p>
		<p>De gegevens die u hier invult worden niet opgeslagen of verwerkt.</p>
		</div>
        <form>
		
		    <div class="row">
                <div class="col-12">
                    <button type="button" onclick="clicked();" class="btn btn-primary">Invullen met IRMA</button>
                </div>
            </div>

		    <div class="row">
                <div class="col-12">
                    <div id="feedback"></div>
                </div>
            </div>			

            <div class="row">
                <div class="col-12">
                    <div class="md-form">
                        <input type="text" id="bsn" class="form-control" placeholder="">
                        <label for="bsn">BSN</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="md-form">
                        <input type="text" id="fullname" class="form-control" placeholder="">
                        <label for="fullname">Naam</label>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="md-form">
                        <input type="text" id="adres" class="form-control" placeholder="">
                        <label for="adres">Adres</label>
                    </div>
                </div>
            </div>			
			
            <div class="row">
                <div class="col-12">
                    <div class="md-form">
                        <input type="text" id="woonplaats" class="form-control" placeholder="">
                        <label for="woonplaats">Postcode / Woonplaats</label>
                    </div>
                </div>
            </div>	

            <div class="row">
                <div class="col-12">
                    <div class="md-form">
                        <input type="text" id="over18" class="form-control" placeholder="">
                        <label for="woonplaats">Boven 18 jaar</label>
                    </div>
                </div>
            </div>				
			
        </form>
    </div>
</main>

<footer class="page-footer">
    <div class="footer-content">
        <div class="container">
            <div class="row">
                <div class="hidden-md-down col-lg-6">
                    <!-- Space for other content/links -->
                </div>
                <div class="col-md-12 col-lg-6">
                    <div class="row">
                        <div class="hidden-md-down col-lg-5">
                            <p class="title">Over deze site</p>
                            <ul class="link-list">
                                <li><a href="https://www.nijmegen.nl/toegankelijkheid/">Toegankelijkheid</a></li>
                                <li><a href="https://www.nijmegen.nl/privacyverklaring/">Privacyverklaring</a></li>
                                <li><a href="https://www.nijmegen.nl/cookies/">Cookies</a></li>
                                <li><a href="https://www.nijmegen.nl/proclaimer/">Proclaimer</a></li>
                                <li><a href="https://www.nijmegen.nl/sitemap/">Sitemap</a></li>
                            </ul>
                        </div>

                        <div class="col-xs-12 col-md-6 col-lg-7">
                            <p class="title">Contactgegevens</p>
                            <ul class="link-list contact-list">
                                <li><i class="mdi mdi-map-marker" aria-hidden="true"></i> Stadswinkel, MariÃ«nburg 30</li>
                                <li><i class="mdi mdi-phone" aria-hidden="true"></i> <a href="tel:14024">14 024</a></li>
                                <li><i class="mdi mdi-email" aria-hidden="true"></i> <a href="mailto:gemeente@nijmegen.nl">gemeente@nijmegen.nl</a>
                                </li>
                                <li><i class="mdi mdi-facebook-box" aria-hidden="true"></i> <a href="https://www.facebook.com/gemeentenijmegen">Gemeente Nijmegen</a></li>
                                <li><i class="mdi mdi-twitter-box" aria-hidden="true"></i> <a href="https://twitter.com/gem_nijmegen">@nijmegen</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container-fluid">
            <img src="img/beeldmerkwit.svg" height="32" width="25" class="logo-labeled" alt="">
            Gemeente Nijmegen
        </div>
    </div>
</footer>


<!-- SCRIPTS -->
<!-- Bootstrap tooltips -->
<script src="js/tether.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script src="js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script src="js/mdb.min.js"></script>
<!-- Search API -->
<script src="https://www.openindex.io/js/openindex.69694b9315763c81.js"></script>
</body>
</html>


